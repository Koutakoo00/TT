<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Train Talk - ã‚¢ãƒ—ãƒªç‰ˆ</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      background-color: #f0f0f0;
      margin: 0;
    }

    .header {
      width: 100%;
      background: #007bff;
      color: white;
      text-align: center;
      padding: 15px;
      font-size: 24px;
      font-weight: bold;
      position: fixed;
      top: 0;
      z-index: 1000;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .grid-container {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: repeat(4, auto);
      gap: 8px;
      width: 90%;
      max-width: 1000px;
      margin-top: 80px;
    }

    .grid-item {
      background: white;
      padding: 8px;
      text-align: center;
      border-radius: 5px;
      box-shadow: 0px 2px 2px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: background-color 0.2s, transform 0.2s;
      min-height: 80px;
      min-width: 80px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .grid-item:hover {
      background-color: #e0f0ff;
    }

    .grid-item:active {
      transform: scale(0.98);
    }

    .grid-item img {
      width: 60px;
      height: 60px;
      margin-bottom: 5px;
    }

    .grid-item span {
      font-size: 20px;
      white-space: nowrap;
    }

    .page {
      display: none;
    }

    .active {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
    }

    .back-button {
      position: absolute;
      top: 60px;
      left: 10px;
      background: #007bff;
      color: white;
      padding: 8px 12px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 999;
      transition: background-color 0.2s;
    }

    .back-button:active {
      background-color: #0056b3;
    }

    .local-talk-wrapper, .hobby-matching-wrapper {
      display: flex;
      flex-direction: column;
      gap: 20px;
      width: 90%;
      max-width: 500px;
      margin-top: 100px;
    }

    .nearby-users, .matching-users {
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0px 4px 8px rgba(0,0,0,0.1);
      width: 100%;
    }

    .nearby-users h3, .matching-users h3 {
      margin: 0 0 10px;
      font-size: 18px;
    }

    .user-list {
      max-height: 200px;
      overflow-y: auto;
    }

    .user-item {
      padding: 10px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .user-item:hover {
      background: #f5f5f5;
    }

    .user-item:active {
      background: #e0e0e0;
    }

    .post-container, .search-container {
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0px 4px 8px rgba(0,0,0,0.1);
      width: 100%;
    }

    .post-list {
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0px 4px 8px rgba(0,0,0,0.1);
      max-height: 400px;
      overflow-y: auto;
      width: 100%;
    }

    textarea, input[type="text"] {
      width: 100%;
      height: 80px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
      padding: 10px;
      resize: none;
    }

    input[type="text"] {
      height: 40px;
    }

    .post-button, .search-button {
      width: 100%;
      padding: 10px;
      background: #007bff;
      color: white;
      font-size: 18px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 15px;
      transition: background-color 0.2s;
    }

    .post-button:active, .search-button:active {
      background-color: #0056b3;
    }

    .post {
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0px 4px 8px rgba(0,0,0,0.1);
      margin-bottom: 15px;
      position: relative;
    }

    .reply-button, .like-button, .friend-request-button, .accept-friend-button {
      background: none;
      border: none;
      color: #007bff;
      cursor: pointer;
      margin-right: 10px;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      transition: color 0.2s;
    }

    .like-button.liked {
      color: #ff0000;
    }

    .like-button .heart-emoji {
      font-size: 14px;
    }

    .reply-button .reply-emoji {
      font-size: 14px;
    }

    .like-count {
      color: #007bff;
      font-size: 14px;
    }

    .profile-container, .settings-container {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0px 4px 8px rgba(0,0,0,0.1);
      width: 90%;
      max-width: 400px;
      margin-top: 100px;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .profile-container img {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 15px;
      border: 2px solid #ccc;
    }

    .profile-container input[type="text"], .settings-container select, .profile-container select {
      width: 100%;
      max-width: 300px;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
      margin: 10px 0;
    }

    .profile-container textarea {
      width: 100%;
      max-width: 300px;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
      margin: 10px 0;
    }

    .profile-container input[type="file"] {
      margin: 10px 0;
      font-size: 14px;
    }

    .profile-container button, .settings-container button {
      width: 100%;
      max-width: 300px;
      padding: 10px;
      background: #007bff;
      color: white;
      font-size: 18px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 15px;
      transition: background-color 0.2s;
    }

    .profile-container button:active, .settings-container button:active {
      background-color: #0056b3;
    }

    .profile-container label {
      font-size: 14px;
      color: #333;
      margin-top: 10px;
      display: block;
    }

    .save-message, .language-change-message, .friend-request-message {
      display: none;
      color: #28a745;
      font-size: 16px;
      margin-top: 10px;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
    }

    .save-message.show, .language-change-message.show, .friend-request-message.show {
      display: block;
      opacity: 1;
    }

    .announcement-container {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0px 4px 8px rgba(0,0,0,0.1);
      width: 90%;
      max-width: 500px;
      margin-top: 100px;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .announcement-container input[type="password"], .announcement-container input[type="text"] {
      width: 100%;
      max-width: 300px;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
      margin: 10px 0;
    }

    .announcement-list {
      width: 100%;
      max-height: 400px;
      overflow-y: auto;
      margin-top: 20px;
    }

    .announcement-item {
      background: #f9f9f9;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 10px;
      text-align: left;
    }

    .chat-container {
      margin-top: 20px;
      width: 100%;
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0px 4px 8px rgba(0,0,0,0.1);
    }

    .chat-messages {
      max-height: 300px;
      overflow-y: auto;
      margin-bottom: 10px;
    }

    .chat-message {
      margin: 10px 0;
      padding: 10px;
      border-radius: 5px;
      background: #f5f5f5;
    }

    .chat-message.sent {
      background: #e0f0ff;
      margin-left: 20px;
    }

    .chat-message.received {
      background: #f0f0f0;
      margin-right: 20px;
    }

    .notification-container {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0px 4px 8px rgba(0,0,0,0.1);
      width: 90%;
      max-width: 500px;
      margin-top: 100px;
      text-align: center;
    }

    .notification-list {
      width: 100%;
      max-height: 400px;
      overflow-y: auto;
      margin-top: 20px;
    }

    .notification-item {
      background: #f9f9f9;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 10px;
      text-align: left;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .friend-item {
      background: #f9f9f9;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .friend-item img {
      width: 30px;
      height: 30px;
      border-radius: 50%;
    }
  </style>
</head>
<body>
  <div class="header">
    <span id="header-title" data-i18n="appTitle">Train Talk</span>
  </div>

  <div id="home-page" class="page active">
    <div class="grid-container">
      <div class="grid-item" onclick="showFriends()"><img src="ãƒ•ãƒ¬ãƒ³ãƒ‰.png" alt="ãƒ•ãƒ¬ãƒ³ãƒ‰" /><br><span data-i18n="friends">ãƒ•ãƒ¬ãƒ³ãƒ‰</span></div>
      <div class="grid-item" onclick="showProfile()"><img id="profile-icon" src="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«.png" alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«" /><br><span data-i18n="profile">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</span></div>
      <div class="grid-item" onclick="showNotifications()"><img src="é€šçŸ¥.png" alt="é€šçŸ¥" /><br><span data-i18n="notifications">é€šçŸ¥</span></div>
      <div class="grid-item" onclick="showSettings()"><img src="è¨­å®š.png" alt="è¨­å®š" /><br><span data-i18n="settings">è¨­å®š</span></div>
      <div class="grid-item" onclick="showAnnouncement()"><img src="ãŠçŸ¥ã‚‰ã›.png" alt="ãŠçŸ¥ã‚‰ã›" /><br><span data-i18n="announcements">ãŠçŸ¥ã‚‰ã›</span></div>
      <div class="grid-item" onclick="showHobbyMatching()"><img src="è¶£å‘³ãƒãƒƒãƒãƒ³ã‚°.png" alt="è¶£å‘³ãƒãƒƒãƒãƒ³ã‚°" /><br><span data-i18n="hobbyMatching">è¶£å‘³ãƒãƒƒãƒãƒ³ã‚°</span></div>
      <div class="grid-item" onclick="openTrends()"><img src="ãƒˆãƒ¬ãƒ³ãƒ‰.png" alt="ãƒˆãƒ¬ãƒ³ãƒ‰" /><br><span data-i18n="trends">ãƒˆãƒ¬ãƒ³ãƒ‰</span></div>
      <div class="grid-item" onclick="showLocalTalk()"><img src="ãƒ­ãƒ¼ã‚«ãƒ«ãƒˆãƒ¼ã‚¯.png" alt="ãƒ­ãƒ¼ã‚«ãƒ«ãƒˆãƒ¼ã‚¯" /><br><span data-i18n="localTalk">ãƒ­ãƒ¼ã‚«ãƒ«ãƒˆãƒ¼ã‚¯</span></div>
    </div>
  </div>

  <div id="local-talk-page" class="page">
    <button class="back-button" onclick="showHome()"><span>â¬…</span><span data-i18n="back">æˆ»ã‚‹</span></button>
    <div class="local-talk-wrapper">
      <div class="search-container">
        <input type="text" id="searchInput" data-i18n-placeholder="searchPlaceholder">
        <button class="search-button" onclick="searchPosts()" data-i18n="search">æ¤œç´¢</button>
      </div>
      <div class="nearby-users">
        <h3 data-i18n="nearbyUsers">è¿‘ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼</h3>
        <div id="user-list" class="user-list"></div>
      </div>
      <div class="post-container">
        <textarea id="postText" data-i18n-placeholder="postPlaceholder"></textarea>
        <button class="post-button" onclick="addPost()" data-i18n="post">æŠ•ç¨¿ã™ã‚‹</button>
      </div>
      <div class="post-list" id="postList"></div>
    </div>
  </div>

  <div id="profile-page" class="page">
    <button class="back-button" onclick="showHome()"><span>â¬…</span><span data-i18n="back">æˆ»ã‚‹</span></button>
    <div class="profile-container">
      <img id="profile-image" src="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«.png" alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ" />
      <label for="profile-image-input" data-i18n="selectProfileImage">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã‚’é¸æŠ</label>
      <input type="file" id="profile-image-input" accept="image/*">
      <label for="username" data-i18n="username">ãƒ¦ãƒ¼ã‚¶ãƒ¼å</label>
      <input type="text" id="username" data-i18n-placeholder="usernamePlaceholder" value="ãƒ¦ãƒ¼ã‚¶ãƒ¼">
      <label for="bio" data-i18n="bio">è‡ªå·±ç´¹ä»‹</label>
      <textarea id="bio" data-i18n-placeholder="bioPlaceholder"></textarea>
      <label for="hobby" data-i18n="hobby">è¶£å‘³</label>
      <select id="hobby" data-i18n-placeholder="hobbyPlaceholder">
        <option value="" data-i18n="selectHobby">è¶£å‘³ã‚’é¸æŠ</option>
        <option value="game" data-i18n="hobbyGame">ã‚²ãƒ¼ãƒ </option>
        <option value="music" data-i18n="hobbyMusic">éŸ³æ¥½é‘‘è³</option>
        <option value="video" data-i18n="hobbyVideo">å‹•ç”»é‘‘è³</option>
        <option value="shopping" data-i18n="hobbyShopping">ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°</option>
        <option value="movie" data-i18n="hobbyMovie">æ˜ ç”»é‘‘è³</option>
        <option value="reading" data-i18n="hobbyReading">èª­æ›¸</option>
        <option value="sports" data-i18n="hobbySports">ã‚¹ãƒãƒ¼ãƒ„</option>
        <option value="cooking" data-i18n="hobbyCooking">æ–™ç†</option>
        <option value="travel" data-i18n="hobbyTravel">æ—…è¡Œ</option>
        <option value="photography" data-i18n="hobbyPhotography">å†™çœŸæ’®å½±</option>
      </select>
      <button onclick="saveProfile()" data-i18n="save">ä¿å­˜</button>
      <div id="save-message" class="save-message" data-i18n="saved">ä¿å­˜ã—ã¾ã—ãŸï¼</div>
    </div>
  </div>

  <div id="view-profile-page" class="page">
    <button class="back-button" onclick="showLocalTalk()"><span>â¬…</span><span data-i18n="back">æˆ»ã‚‹</span></button>
    <div class="profile-container">
      <img id="view-profile-image" src="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«.png" alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ" />
      <h3 id="view-username"></h3>
      <p id="view-bio"></p>
      <p id="view-hobby"></p>
      <button class="friend-request-button" onclick="sendFriendRequest()" data-i18n="sendFriendRequest">ãƒ•ãƒ¬ãƒ³ãƒ‰ç”³è«‹</button>
      <div id="friend-request-message" class="friend-request-message" data-i18n="friendRequestSent">ç”³è«‹ã—ã¾ã—ãŸï¼</div>
    </div>
  </div>

  <div id="friends-page" class="page">
    <button class="back-button" onclick="showHome()"><span>â¬…</span><span data-i18n="back">æˆ»ã‚‹</span></button>
    <div class="notification-container">
      <h3 data-i18n="friends">ãƒ•ãƒ¬ãƒ³ãƒ‰</h3>
      <div id="friend-list" class="notification-list"></div>
    </div>
  </div>

  <div id="notifications-page" class="page">
    <button class="back-button" onclick="showHome()"><span>â¬…</span><span data-i18n="back">æˆ»ã‚‹</span></button>
    <div class="notification-container">
      <h3 data-i18n="notifications">é€šçŸ¥</h3>
      <div id="notification-list" class="notification-list"></div>
    </div>
  </div>

  <div id="settings-page" class="page">
    <button class="back-button" onclick="showHome()"><span>â¬…</span><span data-i18n="back">æˆ»ã‚‹</span></button>
    <div class="settings-container">
      <h3 data-i18n="settings">è¨­å®š</h3>
      <label for="language-select" data-i18n="language">è¨€èª</label>
      <select id="language-select" onchange="changeLanguage()">
        <option value="ja" data-i18n="japanese">æ—¥æœ¬èª</option>
        <option value="en" data-i18n="english">è‹±èª</option>
      </select>
      <div id="language-change-message" class="language-change-message" data-i18n="languageChanged">å¤‰æ›´ã—ã¾ã—ãŸï¼</div>
    </div>
  </div>

  <div id="announcement-page" class="page">
    <button class="back-button" onclick="showHome()"><span>â¬…</span><span data-i18n="back">æˆ»ã‚‹</span></button>
    <div class="announcement-container">
      <h3 data-i18n="announcements">ãŠçŸ¥ã‚‰ã›</h3>
      <div id="admin-section" style="display: none;">
        <input type="password" id="admin-password" data-i18n-placeholder="adminPasswordPlaceholder">
        <button class="post-button" onclick="verifyAdmin()" data-i18n="adminLogin">ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³</button>
        <div id="admin-controls" style="display: none;">
          <textarea id="announcement-text" data-i18n-placeholder="announcementPlaceholder"></textarea>
          <button class="post-button" onclick="postAnnouncement()" data-i18n="postAnnouncement">ãŠçŸ¥ã‚‰ã›æŠ•ç¨¿</button>
          <button class="post-button" onclick="showChangePassword()" data-i18n="changePassword">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´</button>
          <div id="change-password-section" style="display: none;">
            <input type="password" id="new-password" data-i18n-placeholder="newPasswordPlaceholder">
            <button class="post-button" onclick="changePassword()" data-i18n="savePassword">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ä¿å­˜</button>
          </div>
        </div>
      </div>
      <button class="post-button" onclick="showAdminSection()" data-i18n="adminMode">ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰</button>
      <div id="announcement-list" class="announcement-list"></div>
    </div>
  </div>

  <div id="hobby-matching-page" class="page">
    <button class="back-button" onclick="showHome()"><span>â¬…</span><span data-i18n="back">æˆ»ã‚‹</span></button>
    <div class="hobby-matching-wrapper">
      <div class="matching-users">
        <h3 data-i18n="matchingUsers">è¶£å‘³ãŒä¸€è‡´ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼</h3>
        <div id="matching-user-list" class="user-list"></div>
      </div>
    </div>
  </div>

  <script>
    // è¨€èªãƒ‡ãƒ¼ã‚¿
    const languageData = {
      ja: {
        appTitle: "Train Talk",
        friends: "ãƒ•ãƒ¬ãƒ³ãƒ‰",
        profile: "ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«",
        notifications: "é€šçŸ¥",
        settings: "è¨­å®š",
        announcements: "ãŠçŸ¥ã‚‰ã›",
        hobbyMatching: "è¶£å‘³ãƒãƒƒãƒãƒ³ã‚°",
        trends: "ãƒˆãƒ¬ãƒ³ãƒ‰",
        localTalk: "ãƒ­ãƒ¼ã‚«ãƒ«ãƒˆãƒ¼ã‚¯",
        back: "æˆ»ã‚‹",
        nearbyUsers: "è¿‘ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼",
        postPlaceholder: "ä»Šä½•ã—ã¦ã‚‹ï¼Ÿ",
        post: "æŠ•ç¨¿ã™ã‚‹",
        reply: "è¿”ä¿¡",
        like: "ã„ã„ã­",
        search: "æ¤œç´¢",
        searchPlaceholder: "æŠ•ç¨¿ã‚’æ¤œç´¢",
        noSearchResults: "æ¤œç´¢çµæœãŒã‚ã‚Šã¾ã›ã‚“ã€‚",
        searchResults: "æ¤œç´¢çµæœ",
        selectProfileImage: "ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã‚’é¸æŠ",
        usernamePlaceholder: "ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›",
        save: "ä¿å­˜",
        saved: "ä¿å­˜ã—ã¾ã—ãŸï¼",
        language: "è¨€èª",
        japanese: "æ—¥æœ¬èª",
        english: "è‹±èª",
        adminPasswordPlaceholder: "ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰",
        adminLogin: "ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³",
        adminMode: "ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰",
        announcementPlaceholder: "ãŠçŸ¥ã‚‰ã›ã‚’å…¥åŠ›",
        postAnnouncement: "ãŠçŸ¥ã‚‰ã›æŠ•ç¨¿",
        changePassword: "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´",
        newPasswordPlaceholder: "æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰",
        savePassword: "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ä¿å­˜",
        noNearbyUsers: "è¿‘ãã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã„ã¾ã›ã‚“ã€‚",
        geolocationError: "ä½ç½®æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ",
        noGeolocation: "ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ä½ç½®æƒ…å ±ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚",
        noAnnouncements: "ãŠçŸ¥ã‚‰ã›ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚",
        emptyAnnouncement: "ãŠçŸ¥ã‚‰ã›ã®å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚",
        announcementPosted: "ãŠçŸ¥ã‚‰ã›ã‚’æŠ•ç¨¿ã—ã¾ã—ãŸã€‚",
        announcementSaveError: "ãŠçŸ¥ã‚‰ã›ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ",
        invalidPassword: "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™ã€‚",
        emptyNewPassword: "æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚",
        passwordChanged: "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¾ã—ãŸã€‚",
        passwordSaveError: "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ",
        trendsError: "ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚µã‚¤ãƒˆã‚’é–‹ã‘ã¾ã›ã‚“ã§ã—ãŸã€‚ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ–ãƒ­ãƒƒã‚«ãƒ¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚",
        languageChanged: "å¤‰æ›´ã—ã¾ã—ãŸï¼",
        chatWith: "ã¨ã®ãƒãƒ£ãƒƒãƒˆ",
        bio: "è‡ªå·±ç´¹ä»‹",
        bioPlaceholder: "è‡ªå·±ç´¹ä»‹ã‚’å…¥åŠ›",
        sendFriendRequest: "ãƒ•ãƒ¬ãƒ³ãƒ‰ç”³è«‹",
        friendRequest: "ã•ã‚“ã‹ã‚‰ãƒ•ãƒ¬ãƒ³ãƒ‰ç”³è«‹ãŒæ¥ã¾ã—ãŸã€‚",
        acceptFriend: "æ‰¿èªã™ã‚‹",
        likedYourPost: "ã•ã‚“ãŒã‚ãªãŸã®æŠ•ç¨¿ã«ã„ã„ã­ã—ã¾ã—ãŸã€‚",
        repliedToYourPost: "ã•ã‚“ãŒã‚ãªãŸã®æŠ•ç¨¿ã«è¿”ä¿¡ã—ã¾ã—ãŸã€‚",
        noFriends: "ãƒ•ãƒ¬ãƒ³ãƒ‰ãŒã„ã¾ã›ã‚“ã€‚",
        friendAccepted: "ã•ã‚“ãŒã‚ãªãŸã®ãƒ•ãƒ¬ãƒ³ãƒ‰ç”³è«‹ã‚’æ‰¿èªã—ã¾ã—ãŸã€‚",
        hobby: "è¶£å‘³",
        selectHobby: "è¶£å‘³ã‚’é¸æŠ",
        hobbyGame: "ã‚²ãƒ¼ãƒ ",
        hobbyMusic: "éŸ³æ¥½é‘‘è³",
        hobbyVideo: "å‹•ç”»é‘‘è³",
        hobbyShopping: "ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°",
        hobbyMovie: "æ˜ ç”»é‘‘è³",
        hobbyReading: "èª­æ›¸",
        hobbySports: "ã‚¹ãƒãƒ¼ãƒ„",
        hobbyCooking: "æ–™ç†",
        hobbyTravel: "æ—…è¡Œ",
        hobbyPhotography: "å†™çœŸæ’®å½±",
        matchingUsers: "è¶£å‘³ãŒä¸€è‡´ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼",
        noMatchingUsers: "åŒã˜è¶£å‘³ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¿‘ãã«ã„ã¾ã›ã‚“ã€‚",
        friendRequestSent: "ç”³è«‹ã—ã¾ã—ãŸï¼"
      },
      en: {
        appTitle: "Train Talk",
        friends: "Friends",
        profile: "Profile",
        notifications: "Notifications",
        settings: "Settings",
        announcements: "Announcements",
        hobbyMatching: "Hobby Matching",
        trends: "Trends",
        localTalk: "Local Talk",
        back: "Back",
        nearbyUsers: "Nearby Users",
        postPlaceholder: "What's up?",
        post: "Post",
        reply: "Reply",
        like: "Like",
        search: "Search",
        searchPlaceholder: "Search posts",
        noSearchResults: "No search results.",
        searchResults: "Search Results",
        selectProfileImage: "Select Profile Image",
        usernamePlaceholder: "Enter username",
        save: "Save",
        saved: "Saved!",
        language: "Language",
        japanese: "Japanese",
        english: "English",
        adminPasswordPlaceholder: "Admin Password",
        adminLogin: "Admin Login",
        adminMode: "Admin Mode",
        announcementPlaceholder: "Enter announcement",
        postAnnouncement: "Post Announcement",
        changePassword: "Change Password",
        newPasswordPlaceholder: "New Password",
        savePassword: "Save Password",
        noNearbyUsers: "No users nearby.",
        geolocationError: "Failed to get location: ",
        noGeolocation: "This browser does not support geolocation.",
        noAnnouncements: "No announcements.",
        emptyAnnouncement: "Please enter the announcement content.",
        announcementPosted: "Announcement posted.",
        announcementSaveError: "Failed to save announcement: ",
        invalidPassword: "Incorrect password.",
        emptyNewPassword: "Please enter a new password.",
        passwordChanged: "Password changed.",
        passwordSaveError: "Failed to save password: ",
        trendsError: "Could not open news site. Please check your popup blocker.",
        languageChanged: "Changed!",
        chatWith: "Chat with",
        bio: "Bio",
        bioPlaceholder: "Enter your bio",
        sendFriendRequest: "Send Friend Request",
        friendRequest: " sent you a friend request.",
        acceptFriend: "Accept",
        likedYourPost: " liked your post.",
        repliedToYourPost: " replied to your post.",
        noFriends: "No friends.",
        friendAccepted: " accepted your friend request.",
        hobby: "Hobby",
        selectHobby: "Select a hobby",
        hobbyGame: "Gaming",
        hobbyMusic: "Music Listening",
        hobbyVideo: "Video Watching",
        hobbyShopping: "Shopping",
        hobbyMovie: "Movie Watching",
        hobbyReading: "Reading",
        hobbySports: "Sports",
        hobbyCooking: "Cooking",
        hobbyTravel: "Traveling",
        hobbyPhotography: "Photography",
        matchingUsers: "Users with Matching Hobbies",
        noMatchingUsers: "No users with the same hobby nearby.",
        friendRequestSent: "Request sent!"
      }
    };

    // åˆæœŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®š
    if (!localStorage.getItem('adminPassword')) {
      localStorage.setItem('adminPassword', 'admin123');
    }

    // è¨€èªåˆæœŸåŒ–
    let currentLanguage = localStorage.getItem('language') || 'ja';
    document.getElementById('language-select').value = currentLanguage;

    // UIãƒ†ã‚­ã‚¹ãƒˆæ›´æ–°
    function updateUIText() {
      document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        element.innerText = languageData[currentLanguage][key] || element.innerText;
      });
      document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
        const key = element.getAttribute('data-i18n-placeholder');
        element.placeholder = languageData[currentLanguage][key] || element.placeholder;
      });
      document.querySelectorAll('.reply-button').forEach(button => {
        button.innerHTML = `${languageData[currentLanguage].reply} <span class="reply-emoji">ğŸ’¬</span>`;
      });
      document.querySelectorAll('.like-button').forEach(button => {
        const isLiked = button.classList.contains('liked');
        button.innerHTML = `${languageData[currentLanguage].like} <span class="heart-emoji">${isLiked ? 'â¤ï¸' : 'ğŸ¤'}</span>`;
      });
      document.querySelectorAll('.friend-request-button').forEach(button => {
        button.innerHTML = `${languageData[currentLanguage].sendFriendRequest}`;
      });
      document.querySelectorAll('.accept-friend-button').forEach(button => {
        button.innerHTML = `${languageData[currentLanguage].acceptFriend}`;
      });
    }

    // è¨€èªå¤‰æ›´
    function changeLanguage() {
      currentLanguage = document.getElementById('language-select').value;
      localStorage.setItem('language', currentLanguage);
      updateUIText();
      document.getElementById('header-title').innerText = languageData[currentLanguage].appTitle;
      showLanguageChangeMessage();
    }

    // è¨€èªå¤‰æ›´ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
    function showLanguageChangeMessage() {
      const message = document.getElementById('language-change-message');
      message.classList.add('show');
      setTimeout(() => {
        message.classList.remove('show');
      }, 2000);
    }

    // ãƒˆãƒ¬ãƒ³ãƒ‰ãƒšãƒ¼ã‚¸ï¼ˆãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚µã‚¤ãƒˆï¼‰ã‚’é–‹ã
    function openTrends() {
      const newsUrl = currentLanguage === 'ja' ? 'https://news.google.com/?hl=ja' : 'https://news.google.com/?hl=en-US';
      try {
        const newWindow = window.open(newsUrl, '_blank');
        if (!newWindow || newWindow.closed || typeof newWindow.closed === 'undefined') {
          alert(languageData[currentLanguage].trendsError);
          window.location.href = newsUrl;
        }
      } catch (error) {
        alert(languageData[currentLanguage].trendsError + " " + error.message);
        window.location.href = newsUrl;
      }
    }

    // ãƒ€ãƒŸãƒ¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿
    const dummyUsers = [
      { id: 1, name: "ãƒ¦ãƒ¼ã‚¶ãƒ¼A", lat: 35.6895, lon: 139.6917, distance: 0, bio: "é‰„é“ãƒãƒ‹ã‚¢ã§ã™ï¼", profileImage: 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«.png', hobby: "game" },
      { id: 2, name: "ãƒ¦ãƒ¼ã‚¶ãƒ¼B", lat: 35.6890, lon: 139.6920, distance: 0, bio: "æ—…è¡ŒãŒå¥½ãï¼", profileImage: 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«.png', hobby: "travel" },
      { id: 3, name: "ãƒ¦ãƒ¼ã‚¶ãƒ¼C", lat: 35.6900, lon: 139.6900, distance: 0, bio: "ã‚ˆã‚ã—ãï¼", profileImage: 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«.png', hobby: "movie" }
    ];

    // ãƒãƒãƒ¼ã‚µã‚¤ãƒ³å…¬å¼ã§è·é›¢è¨ˆç®—ï¼ˆkmï¼‰
    function calculateDistance(lat1, lon1, lat2, lon2) {
      const R = 6371;
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return R * c;
    }

    // è¿‘ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡¨ç¤º
    function showNearbyUsers() {
      if (!navigator.geolocation) {
        alert(languageData[currentLanguage].noGeolocation);
        return;
      }

      navigator.geolocation.getCurrentPosition(
        (position) => {
          const userLat = position.coords.latitude;
          const userLon = position.coords.longitude;

          const userList = document.getElementById("user-list");
          userList.innerHTML = "";

          dummyUsers.forEach(user => {
            user.distance = calculateDistance(userLat, userLon, user.lat, user.lon);
            if (user.distance <= 5) {
              const userItem = document.createElement("div");
              userItem.classList.add("user-item");
              userItem.textContent = `${user.name} (${user.distance.toFixed(2)}km)`;
              userItem.onclick = () => startChat(user.id, user.name);
              userList.appendChild(userItem);
            }
          });

          if (userList.children.length === 0) {
            userList.textContent = languageData[currentLanguage].noNearbyUsers;
          }
        },
        (error) => {
          alert(languageData[currentLanguage].geolocationError + error.message);
        }
      );
    }

    // è¶£å‘³ãƒãƒƒãƒãƒ³ã‚°ãƒšãƒ¼ã‚¸è¡¨ç¤º
    function showHobbyMatching() {
      document.getElementById("home-page").classList.remove("active");
      document.getElementById("local-talk-page").classList.remove("active");
      document.getElementById("profile-page").classList.remove("active");
      document.getElementById("settings-page").classList.remove("active");
      document.getElementById("announcement-page").classList.remove("active");
      document.getElementById("view-profile-page").classList.remove("active");
      document.getElementById("friends-page").classList.remove("active");
      document.getElementById("notifications-page").classList.remove("active");
      document.getElementById("hobby-matching-page").classList.add("active");
      document.getElementById("header-title").innerText = languageData[currentLanguage].hobbyMatching;
      showMatchingUsers();
    }

    // è¶£å‘³ãŒä¸€è‡´ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡¨ç¤º
    function showMatchingUsers() {
      if (!navigator.geolocation) {
        alert(languageData[currentLanguage].noGeolocation);
        return;
      }

      navigator.geolocation.getCurrentPosition(
        (position) => {
          const userLat = position.coords.latitude;
          const userLon = position.coords.longitude;
          const userHobby = localStorage.getItem('hobby') || '';

          const userList = document.getElementById("matching-user-list");
          userList.innerHTML = "";

          dummyUsers.forEach(user => {
            user.distance = calculateDistance(userLat, userLon, user.lat, user.lon);
            if (user.distance <= 5 && user.hobby === userHobby && userHobby !== '') {
              const userItem = document.createElement("div");
              userItem.classList.add("user-item");
              userItem.textContent = `${user.name} (${user.distance.toFixed(2)}km)`;
              userItem.onclick = () => viewUserProfile(user.name);
              userList.appendChild(userItem);
            }
          });

          if (userList.children.length === 0) {
            userList.textContent = languageData[currentLanguage].noMatchingUsers;
          }
        },
        (error) => {
          alert(languageData[currentLanguage].geolocationError + error.message);
        }
      );
    }

    // ãƒãƒ£ãƒƒãƒˆé–‹å§‹
    function startChat(userId, userName) {
      const localTalkWrapper = document.querySelector(".local-talk-wrapper");
      localTalkWrapper.innerHTML = `
        <h3>${languageData[currentLanguage].chatWith} ${userName}</h3>
        <div class="chat-container">
          <div class="chat-messages" id="chatMessages-${userId}"></div>
          <textarea id="chatInput-${userId}" placeholder="${userName} ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡..."></textarea>
          <button class="post-button" onclick="sendChatMessage(${userId}, '${userName}')">${languageData[currentLanguage].post}</button>
        </div>
      `;
      loadChatMessages(userId);
    }

    // ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿
    function loadChatMessages(userId) {
      const chatMessages = document.getElementById(`chatMessages-${userId}`);
      chatMessages.innerHTML = '';
      const messages = JSON.parse(localStorage.getItem(`chat_${userId}`) || '[]');
      messages.forEach(msg => {
        const messageDiv = document.createElement("div");
        messageDiv.classList.add("chat-message", msg.isSent ? "sent" : "received");
        messageDiv.innerHTML = `
          <div style="display: flex; align-items: center;">
            <img src="${msg.profileImage || 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«.png'}" alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ" style="width: 30px; height: 30px; border-radius: 50%; margin-right: 10px;" />
            <strong>${msg.username}</strong>
          </div>
          <p>${msg.text}</p>
          <small>${msg.date}</small>
        `;
        chatMessages.appendChild(messageDiv);
      });
    }

    // ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
    function sendChatMessage(userId, userName) {
      const chatInput = document.getElementById(`chatInput-${userId}`);
      const message = chatInput.value.trim();
      if (!message) return;

      const messages = JSON.parse(localStorage.getItem(`chat_${userId}`) || '[]');
      const newMessage = {
        id: Date.now(),
        username: localStorage.getItem('username') || (currentLanguage === 'ja' ? 'ãƒ¦ãƒ¼ã‚¶ãƒ¼' : 'User'),
        profileImage: localStorage.getItem('profileImage') || 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«.png',
        text: message,
        date: new Date().toLocaleString(currentLanguage === 'ja' ? 'ja-JP' : 'en-US'),
        isSent: true
      };
      messages.push(newMessage);

      // ãƒ€ãƒŸãƒ¼ã®è¿”ä¿¡ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
      const dummyReply = {
        id: Date.now() + 1,
        username: userName,
        profileImage: 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«.png',
        text: `${userName}ã‹ã‚‰ã®è‡ªå‹•è¿”ä¿¡: ã“ã‚“ã«ã¡ã¯ï¼`,
        date: new Date().toLocaleString(currentLanguage === 'ja' ? 'ja-JP' : 'en-US'),
        isSent: false
      };
      messages.push(dummyReply);

      localStorage.setItem(`chat_${userId}`, JSON.stringify(messages));
      chatInput.value = '';
      loadChatMessages(userId);
    }

    // æŠ•ç¨¿æ¤œç´¢
    function searchPosts() {
      const query = document.getElementById("searchInput").value.trim().toLowerCase();
      const postList = document.getElementById("postList");
      postList.innerHTML = `<h3>${languageData[currentLanguage].searchResults}</h3>`;

      const posts = JSON.parse(localStorage.getItem('posts') || '[]');
      const filteredPosts = posts.filter(post => post.text.toLowerCase().includes(query));

      if (filteredPosts.length === 0) {
        postList.innerHTML += `<p>${languageData[currentLanguage].noSearchResults}</p>`;
        return;
      }

      filteredPosts.forEach(post => {
        const postDiv = document.createElement("div");
        postDiv.classList.add("post");
        postDiv.innerHTML = `
          <div style="display: flex; align-items: center; margin-bottom: 10px;">
            <img src="${post.profileImage || 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«.png'}" alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ" style="width: 30px; height: 30px; border-radius: 50%; margin-right: 10px; cursor: pointer;" onclick="viewUserProfile('${post.username}')" />
            <strong>${post.username}</strong>
          </div>
          <p>${post.text}</p>
          <small>${post.date}</small>
          <button class="reply-button" onclick="replyToPost(this, '${post.id}', '${post.username}')">${languageData[currentLanguage].reply} <span class="reply-emoji">ğŸ’¬</span></button>
          <button class="like-button" onclick="toggleLike(this, '${post.id}', '${post.username}')">${languageData[currentLanguage].like} <span class="heart-emoji">ğŸ¤</span></button>
          <span class="like-count">0 ${languageData[currentLanguage].like}</span>
          <div class="reply-section" style="margin-top:10px;"></div>
        `;
        postList.appendChild(postDiv);
      });
    }

    // ãŠçŸ¥ã‚‰ã›ãƒšãƒ¼ã‚¸è¡¨ç¤º
    function showAnnouncement() {
      document.getElementById("home-page").classList.remove("active");
      document.getElementById("local-talk-page").classList.remove("active");
      document.getElementById("profile-page").classList.remove("active");
      document.getElementById("settings-page").classList.remove("active");
      document.getElementById("announcement-page").classList.add("active");
      document.getElementById("view-profile-page").classList.remove("active");
      document.getElementById("friends-page").classList.remove("active");
      document.getElementById("notifications-page").classList.remove("active");
      document.getElementById("hobby-matching-page").classList.remove("active");
      document.getElementById("header-title").innerText = languageData[currentLanguage].announcements;
      loadAnnouncements();
    }

    // ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤º
    function showAdminSection() {
      const adminSection = document.getElementById("admin-section");
      adminSection.style.display = "block";
      document.getElementById("admin-password").style.display = "block";
      document.getElementById("admin-section").querySelector("button").style.display = "block";
      document.getElementById("admin-controls").style.display = "none";
    }

    // ç®¡ç†è€…èªè¨¼
    function verifyAdmin() {
      const password = document.getElementById("admin-password").value.trim();
      const storedPassword = localStorage.getItem('adminPassword');
      if (password === storedPassword) {
        document.getElementById("admin-password").style.display = "none";
        document.getElementById("admin-section").querySelector("button").style.display = "none";
        document.getElementById("admin-controls").style.display = "block";
      } else {
        alert(languageData[currentLanguage].invalidPassword);
      }
    }

    // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤º
    function showChangePassword() {
      document.getElementById("change-password-section").style.display = "block";
    }

    // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´
    function changePassword() {
      const newPassword = document.getElementById("new-password").value.trim();
      if (!newPassword) {
        alert(languageData[currentLanguage].emptyNewPassword);
        return;
      }
      try {
        localStorage.setItem('adminPassword', newPassword);
        document.getElementById("new-password").value = "";
        document.getElementById("change-password-section").style.display = "none";
        alert(languageData[currentLanguage].passwordChanged);
      } catch (e) {
        alert(languageData[currentLanguage].passwordSaveError + e.message);
      }
    }

    // ãŠçŸ¥ã‚‰ã›æŠ•ç¨¿
    function postAnnouncement() {
      const announcementText = document.getElementById("announcement-text").value.trim();
      if (!announcementText) {
        alert(languageData[currentLanguage].emptyAnnouncement);
        return;
      }
      const announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
      announcements.unshift({
        id: Date.now(),
        text: announcementText,
        date: new Date().toLocaleString(currentLanguage === 'ja' ? 'ja-JP' : 'en-US')
      });
      try {
        localStorage.setItem('announcements', JSON.stringify(announcements));
        document.getElementById("announcement-text").value = "";
        loadAnnouncements();
        alert(languageData[currentLanguage].announcementPosted);
      } catch (e) {
        alert(languageData[currentLanguage].announcementSaveError + e.message);
      }
    }

    // ãŠçŸ¥ã‚‰ã›èª­ã¿è¾¼ã¿
    function loadAnnouncements() {
      const announcementList = document.getElementById("announcement-list");
      announcementList.innerHTML = "";
      const announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
      if (announcements.length === 0) {
        announcementList.textContent = languageData[currentLanguage].noAnnouncements;
        return;
      }
      announcements.forEach(announcement => {
        const item = document.createElement("div");
        item.classList.add("announcement-item");
        item.innerHTML = `
          <p>${announcement.text}</p>
          <small>${announcement.date}</small>
        `;
        announcementList.appendChild(item);
      });
    }

    // ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒšãƒ¼ã‚¸è¡¨ç¤º
    function showFriends() {
      document.getElementById("home-page").classList.remove("active");
      document.getElementById("local-talk-page").classList.remove("active");
      document.getElementById("profile-page").classList.remove("active");
      document.getElementById("settings-page").classList.remove("active");
      document.getElementById("announcement-page").classList.remove("active");
      document.getElementById("view-profile-page").classList.remove("active");
      document.getElementById("friends-page").classList.add("active");
      document.getElementById("notifications-page").classList.remove("active");
      document.getElementById("hobby-matching-page").classList.remove("active");
      document.getElementById("header-title").innerText = languageData[currentLanguage].friends;
      loadFriends();
    }

    // é€šçŸ¥ãƒšãƒ¼ã‚¸è¡¨ç¤º
    function showNotifications() {
      document.getElementById("home-page").classList.remove("active");
      document.getElementById("local-talk-page").classList.remove("active");
      document.getElementById("profile-page").classList.remove("active");
      document.getElementById("settings-page").classList.remove("active");
      document.getElementById("announcement-page").classList.remove("active");
      document.getElementById("view-profile-page").classList.remove("active");
      document.getElementById("friends-page").classList.remove("active");
      document.getElementById("notifications-page").classList.add("active");
      document.getElementById("hobby-matching-page").classList.remove("active");
      document.getElementById("header-title").innerText = languageData[currentLanguage].notifications;
      loadNotifications();
    }

    // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸è¡¨ç¤º
    function showProfile() {
      document.getElementById("home-page").classList.remove("active");
      document.getElementById("local-talk-page").classList.remove("active");
      document.getElementById("settings-page").classList.remove("active");
      document.getElementById("announcement-page").classList.remove("active");
      document.getElementById("view-profile-page").classList.remove("active");
      document.getElementById("friends-page").classList.remove("active");
      document.getElementById("notifications-page").classList.remove("active");
      document.getElementById("hobby-matching-page").classList.remove("active");
      document.getElementById("profile-page").classList.add("active");
      document.getElementById("header-title").innerText = languageData[currentLanguage].profile;

      const profileImageInput = document.getElementById('profile-image-input');
      if (profileImageInput) {
        profileImageInput.addEventListener('change', function(event) {
          const file = event.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
              document.getElementById('profile-image').src = e.target.result;
            };
            reader.readAsDataURL(file);
          }
        });
      }
    }

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¡¨ç¤º
    function viewUserProfile(username) {
      document.getElementById("home-page").classList.remove("active");
      document.getElementById("local-talk-page").classList.remove("active");
      document.getElementById("profile-page").classList.remove("active");
      document.getElementById("settings-page").classList.remove("active");
      document.getElementById("announcement-page").classList.remove("active");
      document.getElementById("friends-page").classList.remove("active");
      document.getElementById("notifications-page").classList.remove("active");
      document.getElementById("hobby-matching-page").classList.remove("active");
      document.getElementById("view-profile-page").classList.add("active");
      document.getElementById("header-title").innerText = languageData[currentLanguage].profile;

      const user = dummyUsers.find(u => u.name === username) || {
        name: username,
        bio: "",
        profileImage: localStorage.getItem('profileImage') || 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«.png',
        hobby: localStorage.getItem('hobby') || ''
      };
      document.getElementById("view-username").textContent = user.name;
      document.getElementById("view-bio").textContent = user.bio || languageData[currentLanguage].bioPlaceholder;
      document.getElementById("view-hobby").textContent = user.hobby ? `${languageData[currentLanguage].hobby}: ${languageData[currentLanguage][`hobby${user.hobby.charAt(0).toUpperCase() + user.hobby.slice(1)}`]}` : '';
      document.getElementById("view-profile-image").src = user.profileImage || 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«.png';
      localStorage.setItem('viewingUser', username);
    }

    // ãƒ•ãƒ¬ãƒ³ãƒ‰ç”³è«‹é€ä¿¡
    function sendFriendRequest() {
      const recipient = localStorage.getItem('viewingUser');
      const sender = localStorage.getItem('username') || (currentLanguage === 'ja' ? 'ãƒ¦ãƒ¼ã‚¶ãƒ¼' : 'User');
      const notifications = JSON.parse(localStorage.getItem(`notifications_${recipient}`) || '[]');
      notifications.push({
        id: Date.now(),
        type: 'friendRequest',
        sender: sender,
        date: new Date().toLocaleString(currentLanguage === 'ja' ? 'ja-JP' : 'en-US')
      });
      localStorage.setItem(`notifications_${recipient}`, JSON.stringify(notifications));
      showFriendRequestMessage();
    }

    // ãƒ•ãƒ¬ãƒ³ãƒ‰ç”³è«‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
    function showFriendRequestMessage() {
      const message = document.getElementById('friend-request-message');
      message.classList.add('show');
      setTimeout(() => {
        message.classList.remove('show');
      }, 2000);
    }

    // é€šçŸ¥èª­ã¿è¾¼ã¿
    function loadNotifications() {
      const username = localStorage.getItem('username') || (currentLanguage === 'ja' ? 'ãƒ¦ãƒ¼ã‚¶ãƒ¼' : 'User');
      const notificationList = document.getElementById("notification-list");
      notificationList.innerHTML = "";
      const notifications = JSON.parse(localStorage.getItem(`notifications_${username}`) || '[]');
      if (notifications.length === 0) {
        notificationList.textContent = languageData[currentLanguage].noAnnouncements;
        return;
      }
      notifications.forEach(notification => {
        const item = document.createElement("div");
        item.classList.add("notification-item");
        if (notification.type === 'friendRequest') {
          item.innerHTML = `
            <span>${notification.sender}${languageData[currentLanguage].friendRequest}</span>
            <button class="accept-friend-button" onclick="acceptFriendRequest('${notification.sender}')">${languageData[currentLanguage].acceptFriend}</button>
          `;
        } else if (notification.type === 'like') {
          item.innerHTML = `
            <span>${notification.sender}${languageData[currentLanguage].likedYourPost}</span>
            <small>${notification.date}</small>
          `;
        } else if (notification.type === 'reply') {
          item.innerHTML = `
            <span>${notification.sender}${languageData[currentLanguage].repliedToYourPost}</span>
            <small>${notification.date}</small>
          `;
        } else if (notification.type === 'friendAccepted') {
          item.innerHTML = `
            <span>${notification.sender}${languageData[currentLanguage].friendAccepted}</span>
            <small>${notification.date}</small>
          `;
        }
        notificationList.appendChild(item);
      });
    }

    // ãƒ•ãƒ¬ãƒ³ãƒ‰ç”³è«‹æ‰¿èª
    function acceptFriendRequest(friendName) {
      const username = localStorage.getItem('username') || (currentLanguage === 'ja' ? 'ãƒ¦ãƒ¼ã‚¶ãƒ¼' : 'User');
      const friends = JSON.parse(localStorage.getItem(`friends_${username}`) || '[]');
      if (!friends.includes(friendName)) {
        friends.push(friendName);
        localStorage.setItem(`friends_${username}`, JSON.stringify(friends));
      }
      const notifications = JSON.parse(localStorage.getItem(`notifications_${username}`) || '[]');
      const updatedNotifications = notifications.filter(n => n.sender !== friendName || n.type !== 'friendRequest');
      localStorage.setItem(`notifications_${username}`, JSON.stringify(updatedNotifications));

      // ãƒ•ãƒ¬ãƒ³ãƒ‰ç”³è«‹ã‚’æ‰¿èªã—ãŸã“ã¨ã‚’é€ä¿¡è€…ã«é€šçŸ¥
      const senderNotifications = JSON.parse(localStorage.getItem(`notifications_${friendName}`) || '[]');
      senderNotifications.push({
        id: Date.now(),
        type: 'friendAccepted',
        sender: username,
        date: new Date().toLocaleString(currentLanguage === 'ja' ? 'ja-JP' : 'en-US')
      });
      localStorage.setItem(`notifications_${friendName}`, JSON.stringify(senderNotifications));

      // ç›¸äº’ãƒ•ãƒ¬ãƒ³ãƒ‰é–¢ä¿‚ã‚’è¨­å®š
      const friendFriends = JSON.parse(localStorage.getItem(`friends_${friendName}`) || '[]');
      if (!friendFriends.includes(username)) {
        friendFriends.push(username);
        localStorage.setItem(`friends_${friendName}`, JSON.stringify(friendFriends));
      }

      loadNotifications();
      loadFriends();
    }

    // ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªã‚¹ãƒˆèª­ã¿è¾¼ã¿
    function loadFriends() {
      const username = localStorage.getItem('username') || (currentLanguage === 'ja' ? 'ãƒ¦ãƒ¼ã‚¶ãƒ¼' : 'User');
      const friendList = document.getElementById("friend-list");
      friendList.innerHTML = "";
      const friends = JSON.parse(localStorage.getItem(`friends_${username}`) || '[]');
      if (friends.length === 0) {
        friendList.textContent = languageData[currentLanguage].noFriends;
        return;
      }
      friends.forEach(friend => {
        const friendData = dummyUsers.find(u => u.name === friend) || {
          name: friend,
          profileImage: 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«.png'
        };
        const item = document.createElement("div");
        item.classList.add("friend-item");
        item.innerHTML = `
          <img src="${friendData.profileImage}" alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ" />
          <span>${friend}</span>
        `;
        friendList.appendChild(item);
      });
    }

    // åˆæœŸãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ­ãƒ¼ãƒ‰
    window.onload = function() {
      const savedUsername = localStorage.getItem('username');
      const savedProfileImage = localStorage.getItem('profileImage');
      const savedBio = localStorage.getItem('bio');
      const savedHobby = localStorage.getItem('hobby');
      if (savedUsername) {
        document.getElementById('username').value = savedUsername;
      }
      if (savedProfileImage) {
        document.getElementById('profile-image').src = savedProfileImage;
      }
      if (savedBio) {
        document.getElementById('bio').value = savedBio;
      }
      if (savedHobby) {
        document.getElementById('hobby').value = savedHobby;
      }
      updateUIText();
    };

    function showHome() {
      document.getElementById("local-talk-page").classList.remove("active");
      document.getElementById("profile-page").classList.remove("active");
      document.getElementById("settings-page").classList.remove("active");
      document.getElementById("announcement-page").classList.remove("active");
      document.getElementById("view-profile-page").classList.remove("active");
      document.getElementById("friends-page").classList.remove("active");
      document.getElementById("notifications-page").classList.remove("active");
      document.getElementById("hobby-matching-page").classList.remove("active");
      document.getElementById("home-page").classList.add("active");
      document.getElementById("header-title").innerText = languageData[currentLanguage].appTitle;
    }

    function showLocalTalk() {
      document.getElementById("home-page").classList.remove("active");
      document.getElementById("profile-page").classList.remove("active");
      document.getElementById("settings-page").classList.remove("active");
      document.getElementById("announcement-page").classList.remove("active");
      document.getElementById("view-profile-page").classList.remove("active");
      document.getElementById("friends-page").classList.remove("active");
      document.getElementById("notifications-page").classList.remove("active");
      document.getElementById("hobby-matching-page").classList.remove("active");
      document.getElementById("local-talk-page").classList.add("active");
      document.getElementById("header-title").innerText = languageData[currentLanguage].localTalk;
      document.getElementById("searchInput").value = "";
      document.getElementById("postList").innerHTML = "";
      showNearbyUsers();
    }

    function showSettings() {
      document.getElementById("home-page").classList.remove("active");
      document.getElementById("local-talk-page").classList.remove("active");
      document.getElementById("profile-page").classList.remove("active");
      document.getElementById("announcement-page").classList.remove("active");
      document.getElementById("view-profile-page").classList.remove("active");
      document.getElementById("friends-page").classList.remove("active");
      document.getElementById("notifications-page").classList.remove("active");
      document.getElementById("hobby-matching-page").classList.remove("active");
      document.getElementById("settings-page").classList.add("active");
      document.getElementById("header-title").innerText = languageData[currentLanguage].settings;
    }

    function addPost() {
      let postText = document.getElementById("postText").value;
      if (postText.trim() === "") return;

      let postList = document.getElementById("postList");
      let newPost = document.createElement("div");
      newPost.classList.add("post");
      const username = localStorage.getItem('username') || (currentLanguage === 'ja' ? 'ãƒ¦ãƒ¼ã‚¶ãƒ¼' : 'User');
      const profileImage = localStorage.getItem('profileImage') || 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«.png';
      const postDate = new Date().toLocaleString(currentLanguage === 'ja' ? 'ja-JP' : 'en-US');
      const postId = Date.now();
      newPost.innerHTML = `
        <div style="display: flex; align-items: center; margin-bottom: 10px;">
          <img src="${profileImage}" alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ" style="width: 30px; height: 30px; border-radius: 50%; margin-right: 10px; cursor: pointer;" onclick="viewUserProfile('${username}')" />
          <strong>${username}</strong>
        </div>
        <p>${postText}</p>
        <small>${postDate}</small>
        <button class="reply-button" onclick="replyToPost(this, '${postId}', '${username}')">${languageData[currentLanguage].reply} <span class="reply-emoji">ğŸ’¬</span></button>
        <button class="like-button" onclick="toggleLike(this, '${postId}', '${username}')">${languageData[currentLanguage].like} <span class="heart-emoji">ğŸ¤</span></button>
        <span class="like-count">0 ${languageData[currentLanguage].like}</span>
        <div class="reply-section" style="margin-top:10px;"></div>
      `;
      postList.prepend(newPost);

      // æŠ•ç¨¿ã‚’localStorageã«ä¿å­˜
      const posts = JSON.parse(localStorage.getItem('posts') || '[]');
      posts.unshift({
        id: postId,
        username: username,
        profileImage: profileImage,
        text: postText,
        date: postDate
      });
      try {
        localStorage.setItem('posts', JSON.stringify(posts));
      } catch (e) {
        console.error("æŠ•ç¨¿ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ", e);
      }

      document.getElementById("postText").value = "";
    }

    function toggleLike(button, postId, postOwner) {
      const countSpan = button.nextElementSibling;
      const heartEmoji = button.querySelector('.heart-emoji');
      let current = parseInt(countSpan.textContent);
      if (button.classList.contains("liked")) {
        countSpan.textContent = `${current - 1} ${languageData[currentLanguage].like}`;
        heartEmoji.textContent = 'ğŸ¤';
        button.classList.remove("liked");
      } else {
        countSpan.textContent = `${current + 1} ${languageData[currentLanguage].like}`;
        heartEmoji.textContent = 'â¤ï¸';
        button.classList.add("liked");
        const sender = localStorage.getItem('username') || (currentLanguage === 'ja' ? 'ãƒ¦ãƒ¼ã‚¶ãƒ¼' : 'User');
        if (sender !== postOwner) {
          const notifications = JSON.parse(localStorage.getItem(`notifications_${postOwner}`) || '[]');
          notifications.push({
            id: Date.now(),
            type: 'like',
            sender: sender,
            postId: postId,
            date: new Date().toLocaleString(currentLanguage === 'ja' ? 'ja-JP' : 'en-US')
          });
          localStorage.setItem(`notifications_${postOwner}`, JSON.stringify(notifications));
        }
      }
    }

    function replyToPost(button, postId, postOwner) {
      const post = button.closest(".post");
      const replySection = post.querySelector(".reply-section");

      if (replySection.querySelector("textarea")) return;

      const textarea = document.createElement("textarea");
      textarea.placeholder = languageData[currentLanguage].reply;
      textarea.style = "width:100%; margin-top:10px;";
      const sendBtn = document.createElement("button");
      sendBtn.textContent = languageData[currentLanguage].post;
      sendBtn.className = "post-button";
      sendBtn.style = "margin-top:5px;";
      sendBtn.onclick = () => {
        const replyText = textarea.value.trim();
        if (replyText) {
          const replyP = document.createElement("p");
          replyP.style = "margin-left: 20px; background: #eef; padding: 5px; border-radius: 5px;";
          const username = localStorage.getItem('username') || (currentLanguage === 'ja' ? 'ãƒ¦ãƒ¼ã‚¶ãƒ¼' : 'User');
          replyP.textContent = `${username}: ${replyText}`;
          replySection.appendChild(replyP);
          textarea.remove();
          sendBtn.remove();
          if (username !== postOwner) {
            const notifications = JSON.parse(localStorage.getItem(`notifications_${postOwner}`) || '[]');
            notifications.push({
              id: Date.now(),
              type: 'reply',
              sender: username,
              postId: postId,
              date: new Date().toLocaleString(currentLanguage === 'ja' ? 'ja-JP' : 'en-US')
            });
            localStorage.setItem(`notifications_${postOwner}`, JSON.stringify(notifications));
          }
        }
      };

      replySection.appendChild(textarea);
      replySection.appendChild(sendBtn);
    }

    function saveProfile() {
      const username = document.getElementById('username').value.trim();
      const bio = document.getElementById('bio').value.trim();
      const hobby = document.getElementById('hobby').value;
      const profileImageInput = document.getElementById('profile-image-input');
      const profileImage = document.getElementById('profile-image');
      const saveMessage = document.getElementById('save-message');

      let saved = false;

      if (username) {
        localStorage.setItem('username', username);
        saved = true;
      }

      if (bio) {
        localStorage.setItem('bio', bio);
        saved = true;
      }

      if (hobby) {
        localStorage.setItem('hobby', hobby);
        saved = true;
      }

      if (profileImageInput.files && profileImageInput.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
          profileImage.src = e.target.result;
          localStorage.setItem('profileImage', e.target.result);
          showSaveMessage();
        };
        reader.readAsDataURL(profileImageInput.files[0]);
        saved = true;
      }

      if (saved) {
        showSaveMessage();
      }
    }

    function showSaveMessage() {
      const saveMessage = document.getElementById('save-message');
      saveMessage.classList.add('show');
      setTimeout(() => {
        saveMessage.classList.remove('show');
      }, 2000);
    }
  </script>
</body>
</html>
