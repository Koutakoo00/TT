<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Train Talk - „Ç¢„Éó„É™Áâà</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      background-color: #f0f0f0;
      margin: 0;
    }

    .header {
      width: 100%;
      background: #007bff;
      color: white;
      text-align: center;
      padding: 15px;
      font-size: 24px;
      font-weight: bold;
      position: fixed;
      top: 0;
      z-index: 1000;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .grid-container {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-template-rows: repeat(2, auto);
      gap: 8px;
      width: 90%;
      max-width: 1000px;
      margin-top: 80px;
    }

    .grid-item {
      background: white;
      padding: 8px;
      text-align: center;
      border-radius: 5px;
      box-shadow: 0px 2px 2px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: background-color 0.2s, transform 0.2s;
      min-height: 80px;
      min-width: 80px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .grid-item:hover {
      background-color: #e0f0ff;
    }

    .grid-item:active {
      transform: scale(0.98);
    }

    .grid-item img {
      width: 100px;
      height: 100px;
      margin-bottom: 2px;
    }

    .grid-item span {
      font-size: 20px;
      white-space: nowrap;
    }

    .page {
      display: none;
    }

    .active {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
    }

    .back-button {
      position: absolute;
      top: 60px;
      left: 10px;
      background: #007bff;
      color: white;
      padding: 8px 12px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 999;
    }

    .local-talk-wrapper {
      display: flex;
      flex-direction: column;
      gap: 20px;
      width: 90%;
      max-width: 500px;
      margin-top: 100px;
    }

    .nearby-users {
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0px 4px 8px rgba(0,0,0,0.1);
      width: 100%;
    }

    .nearby-users h3 {
      margin: 0 0 10px;
      font-size: 18px;
    }

    .user-list {
      max-height: 200px;
      overflow-y: auto;
    }

    .user-item {
      padding: 10px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
    }

    .user-item:hover {
      background: #f5f5f5;
    }

    .post-container, .search-container {
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0px 4px 8px rgba(0,0,0,0.1);
      width: 100%;
    }

    .post-list {
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0px 4px 8px rgba(0,0,0,0.1);
      max-height: 400px;
      overflow-y: auto;
      width: 100%;
    }

    textarea, input[type="text"] {
      width: 100%;
      height: 80px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
      padding: 10px;
      resize: none;
    }

    input[type="text"] {
      height: 40px;
    }

    .post-button, .search-button {
      width: 100%;
      padding: 10px;
      background: #007bff;
      color: white;
      font-size: 18px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 15px;
    }

    .post {
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0px 4px 8px rgba(0,0,0,0.1);
      margin-bottom: 15px;
      position: relative;
    }

    .reply-button, .like-button {
      background: none;
      border: none;
      color: #007bff;
      cursor: pointer;
      margin-right: 10px;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      transition: color 0.2s;
    }

    .like-button.liked {
      color: #ff0000;
    }

    .like-button .heart-emoji {
      font-size: 14px;
    }

    .reply-button .reply-emoji {
      font-size: 14px;
    }

    .like-count {
      color: #007bff;
      font-size: 14px;
    }

    .profile-container, .settings-container {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0px 4px 8px rgba(0,0,0,0.1);
      width: 90%;
      max-width: 400px;
      margin-top: 100px;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .profile-container img {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 15px;
      border: 2px solid #ccc;
    }

    .profile-container input[type="text"], .settings-container select {
      width: 100%;
      max-width: 300px;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
      margin: 10px 0;
    }

    .profile-container input[type="file"] {
      margin: 10px 0;
      font-size: 14px;
    }

    .profile-container button, .settings-container button {
      width: 100%;
      max-width: 300px;
      padding: 10px;
      background: #007bff;
      color: white;
      font-size: 18px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 15px;
    }

    .profile-container label {
      font-size: 14px;
      color: #333;
      margin-top: 10px;
      display: block;
    }

    .save-message, .language-change-message {
      display: none;
      color: #28a745;
      font-size: 16px;
      margin-top: 10px;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
    }

    .save-message.show, .language-change-message.show {
      display: block;
      opacity: 1;
    }

    .announcement-container {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0px 4px 8px rgba(0,0,0,0.1);
      width: 90%;
      max-width: 500px;
      margin-top: 100px;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .announcement-container input[type="password"], .announcement-container input[type="text"] {
      width: 100%;
      max-width: 300px;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
      margin: 10px 0;
    }

    .announcement-list {
      width: 100%;
      max-height: 400px;
      overflow-y: auto;
      margin-top: 20px;
    }

    .announcement-item {
      background: #f9f9f9;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 10px;
      text-align: left;
    }
  </style>
</head>
<body>

  <div class="header">
    <span id="header-title" data-i18n="appTitle">Train Talk</span>
  </div>

  <div id="home-page" class="page active">
    <div class="grid-container">
      <div class="grid-item"><img src="„Éï„É¨„É≥„Éâ.png" alt="„Éï„É¨„É≥„Éâ" /><br><span data-i18n="friends">„Éï„É¨„É≥„Éâ</span></div>
      <div class="grid-item" onclick="showProfile()"><img id="profile-icon" src="„Éó„É≠„Éï„Ç£„Éº„É´.png" alt="„Éó„É≠„Éï„Ç£„Éº„É´" /><br><span data-i18n="profile">„Éó„É≠„Éï„Ç£„Éº„É´</span></div>
      <div class="grid-item"><img src="ÈÄöÁü•.png" alt="ÈÄöÁü•" /><br><span data-i18n="notifications">ÈÄöÁü•</span></div>
      <div class="grid-item" onclick="showSettings()"><img src="Ë®≠ÂÆö.png" alt="Ë®≠ÂÆö" /><br><span data-i18n="settings">Ë®≠ÂÆö</span></div>
      <div class="grid-item" onclick="showAnnouncement()"><img src="„ÅäÁü•„Çâ„Åõ.png" alt="„ÅäÁü•„Çâ„Åõ" /><br><span data-i18n="announcements">„ÅäÁü•„Çâ„Åõ</span></div>
      <div class="grid-item"><img src="Ë∂£Âë≥„Éû„ÉÉ„ÉÅ„É≥„Ç∞.png" alt="Ë∂£Âë≥„Éû„ÉÉ„ÉÅ„É≥„Ç∞" /><br><span data-i18n="hobbyMatching">Ë∂£Âë≥„Éû„ÉÉ„ÉÅ„É≥„Ç∞</span></div>
      <div class="grid-item" onclick="openTrends()"><img src="„Éà„É¨„É≥„Éâ.png" alt="„Éà„É¨„É≥„Éâ" /><br><span data-i18n="trends">„Éà„É¨„É≥„Éâ</span></div>
      <div class="grid-item" onclick="showLocalTalk()"><img src="„É≠„Éº„Ç´„É´„Éà„Éº„ÇØ.png" alt="„É≠„Éº„Ç´„É´„Éà„Éº„ÇØ" /><br><span data-i18n="localTalk">„É≠„Éº„Ç´„É´„Éà„Éº„ÇØ</span></div>
    </div>
  </div>

  <div id="local-talk-page" class="page">
    <button class="back-button" onclick="showHome()"><span>‚¨Ö</span><span data-i18n="back">Êàª„Çã</span></button>
    <div class="local-talk-wrapper">
      <div class="search-container">
        <input type="text" id="searchInput" data-i18n-placeholder="searchPlaceholder">
        <button class="search-button" onclick="searchPosts()" data-i18n="search">Ê§úÁ¥¢</button>
      </div>
      <div class="nearby-users">
        <h3 data-i18n="nearbyUsers">Ëøë„Åè„ÅÆ„É¶„Éº„Ç∂„Éº</h3>
        <div id="user-list" class="user-list"></div>
      </div>
      <div class="post-container">
        <textarea id="postText" data-i18n-placeholder="postPlaceholder"></textarea>
        <button class="post-button" onclick="addPost()" data-i18n="post">ÊäïÁ®ø„Åô„Çã</button>
      </div>
      <div class="post-list" id="postList"></div>
    </div>
  </div>

  <div id="profile-page" class="page">
    <button class="back-button" onclick="showHome()"><span>‚¨Ö</span><span data-i18n="back">Êàª„Çã</span></button>
    <div class="profile-container">
      <img id="profile-image" src="„Éó„É≠„Éï„Ç£„Éº„É´.png" alt="„Éó„É≠„Éï„Ç£„Éº„É´ÁîªÂÉè" />
      <label for="profile-image-input" data-i18n="selectProfileImage">„Éó„É≠„Éï„Ç£„Éº„É´ÁîªÂÉè„ÇíÈÅ∏Êäû</label>
      <input type="file" id="profile-image-input" accept="image/*">
      <input type="text" id="username" data-i18n-placeholder="usernamePlaceholder" value="„É¶„Éº„Ç∂„Éº">
      <button onclick="saveProfile()" data-i18n="save">‰øùÂ≠ò</button>
      <div id="save-message" class="save-message" data-i18n="saved">Â§âÊõ¥„Åó„Åæ„Åó„ÅüÔºÅ</div>
    </div>
  </div>

  <div id="settings-page" class="page">
    <button class="back-button" onclick="showHome()"><span>‚¨Ö</span><span data-i18n="back">Êàª„Çã</span></button>
    <div class="settings-container">
      <h3 data-i18n="settings">Ë®≠ÂÆö</h3>
      <label for="language-select" data-i18n="language">Ë®ÄË™û</label>
      <select id="language-select" onchange="changeLanguage()">
        <option value="ja" data-i18n="japanese">Êó•Êú¨Ë™û</option>
        <option value="en" data-i18n="english">Ëã±Ë™û</option>
      </select>
      <div id="language-change-message" class="language-change-message" data-i18n="languageChanged">Â§âÊõ¥„Åó„Åæ„Åó„ÅüÔºÅ</div>
    </div>
  </div>

  <div id="announcement-page" class="page">
    <button class="back-button" onclick="showHome()"><span>‚¨Ö</span><span data-i18n="back">Êàª„Çã</span></button>
    <div class="announcement-container">
      <h3 data-i18n="announcements">„ÅäÁü•„Çâ„Åõ</h3>
      <div id="admin-section" style="display: none;">
        <input type="password" id="admin-password" data-i18n-placeholder="adminPasswordPlaceholder">
        <button class="post-button" onclick="verifyAdmin()" data-i18n="adminLogin">ÁÆ°ÁêÜËÄÖ„É≠„Ç∞„Ç§„É≥</button>
        <div id="admin-controls" style="display: none;">
          <textarea id="announcement-text" data-i18n-placeholder="announcementPlaceholder"></textarea>
          <button class="post-button" onclick="postAnnouncement()" data-i18n="postAnnouncement">„ÅäÁü•„Çâ„ÅõÊäïÁ®ø</button>
          <button class="post-button" onclick="showChangePassword()" data-i18n="changePassword">„Éë„Çπ„ÉØ„Éº„ÉâÂ§âÊõ¥</button>
          <div id="change-password-section" style="display: none;">
            <input type="password" id="new-password" data-i18n-placeholder="newPasswordPlaceholder">
            <button class="post-button" onclick="changePassword()" data-i18n="savePassword">„Éë„Çπ„ÉØ„Éº„Éâ„Çí‰øùÂ≠ò</button>
          </div>
        </div>
      </div>
      <button class="post-button" onclick="showAdminSection()" data-i18n="adminMode">ÁÆ°ÁêÜËÄÖ„É¢„Éº„Éâ</button>
      <div id="announcement-list" class="announcement-list"></div>
    </div>
  </div>

  <script>
    // Ë®ÄË™û„Éá„Éº„Çø
    const languageData = {
      ja: {
        appTitle: "Train Talk",
        friends: "„Éï„É¨„É≥„Éâ",
        profile: "„Éó„É≠„Éï„Ç£„Éº„É´",
        notifications: "ÈÄöÁü•",
        settings: "Ë®≠ÂÆö",
        announcements: "„ÅäÁü•„Çâ„Åõ",
        hobbyMatching: "Ë∂£Âë≥„Éû„ÉÉ„ÉÅ„É≥„Ç∞",
        trends: "„Éà„É¨„É≥„Éâ",
        localTalk: "„É≠„Éº„Ç´„É´„Éà„Éº„ÇØ",
        back: "Êàª„Çã",
        nearbyUsers: "Ëøë„Åè„ÅÆ„É¶„Éº„Ç∂„Éº",
        postPlaceholder: "‰ªä‰Ωï„Åó„Å¶„ÇãÔºü",
        post: "ÊäïÁ®ø„Åô„Çã",
        reply: "Ëøî‰ø°",
        like: "„ÅÑ„ÅÑ„Å≠",
        search: "Ê§úÁ¥¢",
        searchPlaceholder: "ÊäïÁ®ø„ÇíÊ§úÁ¥¢",
        noSearchResults: "Ê§úÁ¥¢ÁµêÊûú„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ",
        searchResults: "Ê§úÁ¥¢ÁµêÊûú",
        selectProfileImage: "„Éó„É≠„Éï„Ç£„Éº„É´ÁîªÂÉè„ÇíÈÅ∏Êäû",
        usernamePlaceholder: "„É¶„Éº„Ç∂„ÉºÂêç„ÇíÂÖ•Âäõ",
        save: "‰øùÂ≠ò",
        saved: "Â§âÊõ¥„Åó„Åæ„Åó„ÅüÔºÅ",
        language: "Ë®ÄË™û",
        japanese: "Êó•Êú¨Ë™û",
        english: "Ëã±Ë™û",
        adminPasswordPlaceholder: "ÁÆ°ÁêÜËÄÖ„Éë„Çπ„ÉØ„Éº„Éâ",
        adminLogin: "ÁÆ°ÁêÜËÄÖ„É≠„Ç∞„Ç§„É≥",
        adminMode: "ÁÆ°ÁêÜËÄÖ„É¢„Éº„Éâ",
        announcementPlaceholder: "„ÅäÁü•„Çâ„Åõ„ÇíÂÖ•Âäõ",
        postAnnouncement: "„ÅäÁü•„Çâ„ÅõÊäïÁ®ø",
        changePassword: "„Éë„Çπ„ÉØ„Éº„ÉâÂ§âÊõ¥",
        newPasswordPlaceholder: "Êñ∞„Åó„ÅÑ„Éë„Çπ„ÉØ„Éº„Éâ",
        savePassword: "„Éë„Çπ„ÉØ„Éº„Éâ„Çí‰øùÂ≠ò",
        noNearbyUsers: "Ëøë„Åè„Å´„É¶„Éº„Ç∂„Éº„Åå„ÅÑ„Åæ„Åõ„Çì„ÄÇ",
        geolocationError: "‰ΩçÁΩÆÊÉÖÂ†±„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ",
        noGeolocation: "„Åì„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØ‰ΩçÁΩÆÊÉÖÂ†±„Çí„Çµ„Éù„Éº„Éà„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ",
        noAnnouncements: "„ÅäÁü•„Çâ„Åõ„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ",
        emptyAnnouncement: "„ÅäÁü•„Çâ„Åõ„ÅÆÂÜÖÂÆπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
        announcementPosted: "„ÅäÁü•„Çâ„Åõ„ÇíÊäïÁ®ø„Åó„Åæ„Åó„Åü„ÄÇ",
        announcementSaveError: "„ÅäÁü•„Çâ„Åõ„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ",
        invalidPassword: "„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÈñìÈÅï„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
        emptyNewPassword: "Êñ∞„Åó„ÅÑ„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
        passwordChanged: "„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂ§âÊõ¥„Åó„Åæ„Åó„Åü„ÄÇ",
        passwordSaveError: "„Éë„Çπ„ÉØ„Éº„Éâ„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ",
        trendsError: "„Éã„É•„Éº„Çπ„Çµ„Ç§„Éà„ÇíÈñã„Åë„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Éñ„É≠„ÉÉ„Ç´„Éº„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
        languageChanged: "Â§âÊõ¥„Åó„Åæ„Åó„ÅüÔºÅ"
      },
      en: {
        appTitle: "Train Talk",
        friends: "Friends",
        profile: "Profile",
        notifications: "Notifications",
        settings: "Settings",
        announcements: "Announcements",
        hobbyMatching: "Hobby Matching",
        trends: "Trends",
        localTalk: "Local Talk",
        back: "Back",
        nearbyUsers: "Nearby Users",
        postPlaceholder: "What's up?",
        post: "Post",
        reply: "Reply",
        like: "Like",
        search: "Search",
        searchPlaceholder: "Search posts",
        noSearchResults: "No search results.",
        searchResults: "Search Results",
        selectProfileImage: "Select Profile Image",
        usernamePlaceholder: "Enter username",
        save: "Save",
        saved: "Changed!",
        language: "Language",
        japanese: "Japanese",
        english: "English",
        adminPasswordPlaceholder: "Admin Password",
        adminLogin: "Admin Login",
        adminMode: "Admin Mode",
        announcementPlaceholder: "Enter announcement",
        postAnnouncement: "Post Announcement",
        changePassword: "Change Password",
        newPasswordPlaceholder: "New Password",
        savePassword: "Save Password",
        noNearbyUsers: "No users nearby.",
        geolocationError: "Failed to get location: ",
        noGeolocation: "This browser does not support geolocation.",
        noAnnouncements: "No announcements.",
        emptyAnnouncement: "Please enter the announcement content.",
        announcementPosted: "Announcement posted.",
        announcementSaveError: "Failed to save announcement: ",
        invalidPassword: "Incorrect password.",
        emptyNewPassword: "Please enter a new password.",
        passwordChanged: "Password changed.",
        passwordSaveError: "Failed to save password: ",
        trendsError: "Could not open news site. Please check your popup blocker.",
        languageChanged: "Changed!"
      }
    };

    // ÂàùÊúü„Éë„Çπ„ÉØ„Éº„ÉâË®≠ÂÆö
    if (!localStorage.getItem('adminPassword')) {
      localStorage.setItem('adminPassword', 'admin123');
    }

    // Ë®ÄË™ûÂàùÊúüÂåñ
    let currentLanguage = localStorage.getItem('language') || 'ja';
    document.getElementById('language-select').value = currentLanguage;

    // UI„ÉÜ„Ç≠„Çπ„ÉàÊõ¥Êñ∞
    function updateUIText() {
      document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        element.innerText = languageData[currentLanguage][key] || element.innerText;
      });
      document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
        const key = element.getAttribute('data-i18n-placeholder');
        element.placeholder = languageData[currentLanguage][key] || element.placeholder;
      });
      // ÊäïÁ®øÊ∏à„Åø„ÅÆ„Éú„Çø„É≥„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„ÇíÊõ¥Êñ∞
      document.querySelectorAll('.reply-button').forEach(button => {
        button.innerHTML = `${languageData[currentLanguage].reply} <span class="reply-emoji">üí¨</span>`;
      });
      document.querySelectorAll('.like-button').forEach(button => {
        const isLiked = button.classList.contains('liked');
        button.innerHTML = `${languageData[currentLanguage].like} <span class="heart-emoji">${isLiked ? '‚ù§Ô∏è' : 'ü§ç'}</span>`;
      });
    }

    // Ë®ÄË™ûÂ§âÊõ¥
    function changeLanguage() {
      currentLanguage = document.getElementById('language-select').value;
      localStorage.setItem('language', currentLanguage);
      updateUIText();
      document.getElementById('header-title').innerText = languageData[currentLanguage].appTitle;
      showLanguageChangeMessage();
    }

    // Ë®ÄË™ûÂ§âÊõ¥„É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫
    function showLanguageChangeMessage() {
      const message = document.getElementById('language-change-message');
      message.classList.add('show');
      setTimeout(() => {
        message.classList.remove('show');
      }, 2000);
    }

    // „Éà„É¨„É≥„Éâ„Éö„Éº„Ç∏Ôºà„Éã„É•„Éº„Çπ„Çµ„Ç§„ÉàÔºâ„ÇíÈñã„Åè
    function openTrends() {
      console.log("„Éà„É¨„É≥„Éâ„Éú„Çø„É≥„Åå„ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü„ÄÇË®ÄË™û: " + currentLanguage);
      const newsUrl = currentLanguage === 'ja' ? 'https://news.google.com/?hl=ja' : 'https://news.google.com/?hl=en-US';
      console.log("Èñã„Åì„ÅÜ„Å®„Åó„Å¶„ÅÑ„ÇãURL: " + newsUrl);
      try {
        const newWindow = window.open(newsUrl, '_blank');
        if (!newWindow || newWindow.closed || typeof newWindow.closed === 'undefined') {
          alert(languageData[currentLanguage].trendsError);
          window.location.href = newsUrl;
        }
      } catch (error) {
        console.error("„Éà„É¨„É≥„Éâ„É™„É≥„ÇØ„Ç®„É©„Éº: ", error);
        alert(languageData[currentLanguage].trendsError + " " + error.message);
        window.location.href = newsUrl;
      }
    }

    // „ÉÄ„Éü„Éº„ÅÆ„É¶„Éº„Ç∂„Éº„Éá„Éº„Çø
    const dummyUsers = [
      { id: 1, name: "„É¶„Éº„Ç∂„ÉºA", lat: 35.6895, lon: 139.6917, distance: 0 }, // Êù±‰∫¨
      { id: 2, name: "„É¶„Éº„Ç∂„ÉºB", lat: 35.6890, lon: 139.6920, distance: 0 },
      { id: 3, name: "„É¶„Éº„Ç∂„ÉºC", lat: 35.6900, lon: 139.6900, distance: 0 }
    ];

    // „Éè„Éê„Éº„Çµ„Ç§„É≥ÂÖ¨Âºè„ÅßË∑ùÈõ¢Ë®àÁÆóÔºàkmÔºâ
    function calculateDistance(lat1, lon1, lat2, lon2) {
      const R = 6371;
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return R * c;
    }

    // Ëøë„Åè„ÅÆ„É¶„Éº„Ç∂„ÉºË°®Á§∫
    function showNearbyUsers() {
      if (!navigator.geolocation) {
        alert(languageData[currentLanguage].noGeolocation);
        return;
      }

      navigator.geolocation.getCurrentPosition(
        (position) => {
          const userLat = position.coords.latitude;
          const userLon = position.coords.longitude;

          const userList = document.getElementById("user-list");
          userList.innerHTML = "";

          dummyUsers.forEach(user => {
            user.distance = calculateDistance(userLat, userLon, user.lat, user.lon);
            if (user.distance <= 5) {
              const userItem = document.createElement("div");
              userItem.classList.add("user-item");
              userItem.textContent = `${user.name} (${user.distance.toFixed(2)}km)`;
              userItem.onclick = () => startChat(user.id, user.name);
              userList.appendChild(userItem);
            }
          });

          if (userList.children.length === 0) {
            userList.textContent = languageData[currentLanguage].noNearbyUsers;
          }
        },
        (error) => {
          alert(languageData[currentLanguage].geolocationError + error.message);
        }
      );
    }

    // „ÉÅ„É£„ÉÉ„ÉàÈñãÂßã
    function startChat(userId, userName) {
      const postList = document.getElementById("postList");
      postList.innerHTML = `<h3>${userName} „Å®„ÅÆ„ÉÅ„É£„ÉÉ„Éà</h3>`;
      const chatInput = document.createElement("textarea");
      chatInput.placeholder = `${userName} „Å´„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÈÄÅ‰ø°...`;
      chatInput.style.width = "100%";
      chatInput.style.marginTop = "10px";
      const sendButton = document.createElement("button");
      sendButton.textContent = languageData[currentLanguage].post;
      sendButton.className = "post-button";
      sendButton.onclick = () => {
        const message = chatInput.value.trim();
        if (message) {
          const messageDiv = document.createElement("div");
          messageDiv.classList.add("post");
          messageDiv.innerHTML = `
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
              <img src="${localStorage.getItem('profileImage') || '„Éó„É≠„Éï„Ç£„Éº„É´.png'}" alt="„Éó„É≠„Éï„Ç£„Éº„É´ÁîªÂÉè" style="width: 30px; height: 30px; border-radius: 50%; margin-right: 10px;" />
              <strong>${localStorage.getItem('username') || (currentLanguage === 'ja' ? '„É¶„Éº„Ç∂„Éº' : 'User')}</strong>
            </div>
            <p>${message}</p>
          `;
          postList.appendChild(messageDiv);
          chatInput.value = "";
        }
      };
      postList.appendChild(chatInput);
      postList.appendChild(sendButton);
    }

    // ÊäïÁ®øÊ§úÁ¥¢Ôºà„É≠„Éº„Ç´„É´„Éà„Éº„ÇØ„Éö„Éº„Ç∏„Åß‰ΩøÁî®Ôºâ
    function searchPosts() {
      const query = document.getElementById("searchInput").value.trim().toLowerCase();
      const postList = document.getElementById("postList");
      postList.innerHTML = `<h3>${languageData[currentLanguage].searchResults}</h3>`;

      const posts = JSON.parse(localStorage.getItem('posts') || '[]');
      const filteredPosts = posts.filter(post => post.text.toLowerCase().includes(query));

      if (filteredPosts.length === 0) {
        postList.innerHTML += `<p>${languageData[currentLanguage].noSearchResults}</p>`;
        return;
      }

      filteredPosts.forEach(post => {
        const postDiv = document.createElement("div");
        postDiv.classList.add("post");
        postDiv.innerHTML = `
          <div style="display: flex; align-items: center; margin-bottom: 10px;">
            <img src="${post.profileImage || '„Éó„É≠„Éï„Ç£„Éº„É´.png'}" alt="„Éó„É≠„Éï„Ç£„Éº„É´ÁîªÂÉè" style="width: 30px; height: 30px; border-radius: 50%; margin-right: 10px;" />
            <strong>${post.username}</strong>
          </div>
          <p>${post.text}</p>
          <small>${post.date}</small>
          <button class="reply-button" onclick="replyToPost(this)">${languageData[currentLanguage].reply} <span class="reply-emoji">üí¨</span></button>
          <button class="like-button" onclick="toggleLike(this)">${languageData[currentLanguage].like} <span class="heart-emoji">ü§ç</span></button>
          <span class="like-count">0 ${languageData[currentLanguage].like}</span>
          <div class="reply-section" style="margin-top:10px;"></div>
        `;
        postList.appendChild(postDiv);
      });
    }

    // „ÅäÁü•„Çâ„Åõ„Éö„Éº„Ç∏Ë°®Á§∫
    function showAnnouncement() {
      document.getElementById("home-page").classList.remove("active");
      document.getElementById("local-talk-page").classList.remove("active");
      document.getElementById("profile-page").classList.remove("active");
      document.getElementById("settings-page").classList.remove("active");
      document.getElementById("announcement-page").classList.add("active");
      document.getElementById("header-title").innerText = languageData[currentLanguage].announcements;
      loadAnnouncements();
    }

    // ÁÆ°ÁêÜËÄÖ„É¢„Éº„ÉâË°®Á§∫
    function showAdminSection() {
      console.log("ÁÆ°ÁêÜËÄÖ„É¢„Éº„Éâ„Éú„Çø„É≥„Åå„ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü");
      const adminSection = document.getElementById("admin-section");
      adminSection.style.display = "block";
      document.getElementById("admin-password").style.display = "block";
      document.getElementById("admin-section").querySelector("button").style.display = "block";
      document.getElementById("admin-controls").style.display = "none";
    }

    // ÁÆ°ÁêÜËÄÖË™çË®º
    function verifyAdmin() {
      console.log("ÁÆ°ÁêÜËÄÖ„É≠„Ç∞„Ç§„É≥„ÅåË©¶Ë°å„Åï„Çå„Åæ„Åó„Åü");
      const password = document.getElementById("admin-password").value.trim();
      const storedPassword = localStorage.getItem('adminPassword');
      if (password === storedPassword) {
        console.log("Ë™çË®ºÊàêÂäü");
        document.getElementById("admin-password").style.display = "none";
        document.getElementById("admin-section").querySelector("button").style.display = "none";
        document.getElementById("admin-controls").style.display = "block";
      } else {
        console.log("Ë™çË®ºÂ§±Êïó: ÂÖ•Âäõ=" + password + ", ÊúüÂæÖ=" + storedPassword);
        alert(languageData[currentLanguage].invalidPassword);
      }
    }

    // „Éë„Çπ„ÉØ„Éº„ÉâÂ§âÊõ¥„Éï„Ç©„Éº„É†Ë°®Á§∫
    function showChangePassword() {
      console.log("„Éë„Çπ„ÉØ„Éº„ÉâÂ§âÊõ¥„Éú„Çø„É≥„Åå„ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü");
      document.getElementById("change-password-section").style.display = "block";
    }

    // „Éë„Çπ„ÉØ„Éº„ÉâÂ§âÊõ¥
    function changePassword() {
      console.log("„Éë„Çπ„ÉØ„Éº„Éâ‰øùÂ≠ò„ÅåË©¶Ë°å„Åï„Çå„Åæ„Åó„Åü");
      const newPassword = document.getElementById("new-password").value.trim();
      if (!newPassword) {
        alert(languageData[currentLanguage].emptyNewPassword);
        return;
      }
      try {
        localStorage.setItem('adminPassword', newPassword);
        document.getElementById("new-password").value = "";
        document.getElementById("change-password-section").style.display = "none";
        alert(languageData[currentLanguage].passwordChanged);
      } catch (e) {
        alert(languageData[currentLanguage].passwordSaveError + e.message);
      }
    }

    // „ÅäÁü•„Çâ„ÅõÊäïÁ®ø
    function postAnnouncement() {
      console.log("„ÅäÁü•„Çâ„ÅõÊäïÁ®ø„ÅåË©¶Ë°å„Åï„Çå„Åæ„Åó„Åü");
      const announcementText = document.getElementById("announcement-text").value.trim();
      if (!announcementText) {
        alert(languageData[currentLanguage].emptyAnnouncement);
        return;
      }
      const announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
      announcements.unshift({
        id: Date.now(),
        text: announcementText,
        date: new Date().toLocaleString(currentLanguage === 'ja' ? 'ja-JP' : 'en-US')
      });
      try {
        localStorage.setItem('announcements', JSON.stringify(announcements));
        document.getElementById("announcement-text").value = "";
        loadAnnouncements();
        alert(languageData[currentLanguage].announcementPosted);
      } catch (e) {
        alert(languageData[currentLanguage].announcementSaveError + e.message);
      }
    }

    // „ÅäÁü•„Çâ„ÅõË™≠„ÅøËæº„Åø
    function loadAnnouncements() {
      const announcementList = document.getElementById("announcement-list");
      announcementList.innerHTML = "";
      const announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
      if (announcements.length === 0) {
        announcementList.textContent = languageData[currentLanguage].noAnnouncements;
        return;
      }
      announcements.forEach(announcement => {
        const item = document.createElement("div");
        item.classList.add("announcement-item");
        item.innerHTML = `
          <p>${announcement.text}</p>
          <small>${announcement.date}</small>
        `;
        announcementList.appendChild(item);
      });
    }

    // ÂàùÊúü„Éó„É≠„Éï„Ç£„Éº„É´„É≠„Éº„Éâ
    window.onload = function() {
      const savedUsername = localStorage.getItem('username');
      const savedProfileImage = localStorage.getItem('profileImage');
      if (savedUsername) {
        document.getElementById('username').value = savedUsername;
      }
      if (savedProfileImage) {
        document.getElementById('profile-image').src = savedProfileImage;
      }
      updateUIText();
    };

    // ÁîªÂÉèÈÅ∏ÊäûÊôÇ„Å´„Éó„É¨„Éì„É•„ÉºÊõ¥Êñ∞
    document.getElementById('profile-image-input').addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById('profile-image').src = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    });

    function showHome() {
      document.getElementById("local-talk-page").classList.remove("active");
      document.getElementById("profile-page").classList.remove("active");
      document.getElementById("settings-page").classList.remove("active");
      document.getElementById("announcement-page").classList.remove("active");
      document.getElementById("home-page").classList.add("active");
      document.getElementById("header-title").innerText = languageData[currentLanguage].appTitle;
    }

    function showLocalTalk() {
      document.getElementById("home-page").classList.remove("active");
      document.getElementById("profile-page").classList.remove("active");
      document.getElementById("settings-page").classList.remove("active");
      document.getElementById("announcement-page").classList.remove("active");
      document.getElementById("local-talk-page").classList.add("active");
      document.getElementById("header-title").innerText = languageData[currentLanguage].localTalk;
      document.getElementById("searchInput").value = "";
      document.getElementById("postList").innerHTML = "";
      showNearbyUsers();
    }

    function showProfile() {
      document.getElementById("home-page").classList.remove("active");
      document.getElementById("local-talk-page").classList.remove("active");
      document.getElementById("settings-page").classList.remove("active");
      document.getElementById("announcement-page").classList.remove("active");
      document.getElementById("profile-page").classList.add("active");
      document.getElementById("header-title").innerText = languageData[currentLanguage].profile;
    }

    function showSettings() {
      document.getElementById("home-page").classList.remove("active");
      document.getElementById("local-talk-page").classList.remove("active");
      document.getElementById("profile-page").classList.remove("active");
      document.getElementById("announcement-page").classList.remove("active");
      document.getElementById("settings-page").classList.add("active");
      document.getElementById("header-title").innerText = languageData[currentLanguage].settings;
    }

    function addPost() {
      let postText = document.getElementById("postText").value;
      if (postText.trim() === "") return;

      let postList = document.getElementById("postList");
      let newPost = document.createElement("div");
      newPost.classList.add("post");
      const username = localStorage.getItem('username') || (currentLanguage === 'ja' ? '„É¶„Éº„Ç∂„Éº' : 'User');
      const profileImage = localStorage.getItem('profileImage') || '„Éó„É≠„Éï„Ç£„Éº„É´.png';
      const postDate = new Date().toLocaleString(currentLanguage === 'ja' ? 'ja-JP' : 'en-US');
      newPost.innerHTML = `
        <div style="display: flex; align-items: center; margin-bottom: 10px;">
          <img src="${profileImage}" alt="„Éó„É≠„Éï„Ç£„Éº„É´ÁîªÂÉè" style="width: 30px; height: 30px; border-radius: 50%; margin-right: 10px;" />
          <strong>${username}</strong>
        </div>
        <p>${postText}</p>
        <small>${postDate}</small>
        <button class="reply-button" onclick="replyToPost(this)">${languageData[currentLanguage].reply} <span class="reply-emoji">üí¨</span></button>
        <button class="like-button" onclick="toggleLike(this)">${languageData[currentLanguage].like} <span class="heart-emoji">ü§ç</span></button>
        <span class="like-count">0 ${languageData[currentLanguage].like}</span>
        <div class="reply-section" style="margin-top:10px;"></div>
      `;
      postList.prepend(newPost);

      // ÊäïÁ®ø„ÇílocalStorage„Å´‰øùÂ≠ò
      const posts = JSON.parse(localStorage.getItem('posts') || '[]');
      posts.unshift({
        id: Date.now(),
        username: username,
        profileImage: profileImage,
        text: postText,
        date: postDate
      });
      try {
        localStorage.setItem('posts', JSON.stringify(posts));
      } catch (e) {
        console.error("ÊäïÁ®ø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ", e);
      }

      document.getElementById("postText").value = "";
    }

    function toggleLike(button) {
      const countSpan = button.nextElementSibling;
      const heartEmoji = button.querySelector('.heart-emoji');
      let current = parseInt(countSpan.textContent);
      if (button.classList.contains("liked")) {
        countSpan.textContent = `${current - 1} ${languageData[currentLanguage].like}`;
        heartEmoji.textContent = 'ü§ç';
        button.classList.remove("liked");
      } else {
        countSpan.textContent = `${current + 1} ${languageData[currentLanguage].like}`;
        heartEmoji.textContent = '‚ù§Ô∏è';
        button.classList.add("liked");
      }
    }

    function replyToPost(button) {
      const post = button.closest(".post");
      const replySection = post.querySelector(".reply-section");

      if (replySection.querySelector("textarea")) return;

      const textarea = document.createElement("textarea");
      textarea.placeholder = languageData[currentLanguage].reply;
      textarea.style = "width:100%; margin-top:10px;";
      const sendBtn = document.createElement("button");
      sendBtn.textContent = languageData[currentLanguage].post;
      sendBtn.className = "post-button";
      sendBtn.style = "margin-top:5px;";
      sendBtn.onclick = () => {
        const replyText = textarea.value.trim();
        if (replyText) {
          const replyP = document.createElement("p");
          replyP.style = "margin-left: 20px; background: #eef; padding: 5px; border-radius: 5px;";
          const username = localStorage.getItem('username') || (currentLanguage === 'ja' ? '„É¶„Éº„Ç∂„Éº' : 'User');
          replyP.textContent = `${username}: ${replyText}`;
          replySection.appendChild(replyP);
          textarea.remove();
          sendBtn.remove();
        }
      };

      replySection.appendChild(textarea);
      replySection.appendChild(sendBtn);
    }

    function saveProfile() {
      const username = document.getElementById('username').value.trim();
      const profileImageInput = document.getElementById('profile-image-input');
      const profileImage = document.getElementById('profile-image');
      const saveMessage = document.getElementById('save-message');

      let saved = false;

      if (username) {
        localStorage.setItem('username', username);
        saved = true;
      }

      if (profileImageInput.files && profileImageInput.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
          profileImage.src = e.target.result;
          localStorage.setItem('profileImage', e.target.result);
          showSaveMessage();
        };
        reader.readAsDataURL(profileImageInput.files[0]);
        saved = true;
      }

      if (saved && !profileImageInput.files) {
        showSaveMessage();
      }
    }

    function showSaveMessage() {
      const saveMessage = document.getElementById('save-message');
      saveMessage.classList.add('show');
      setTimeout(() => {
        saveMessage.classList.remove('show');
      }, 2000);
    }
  </script>
</body>
</html>
